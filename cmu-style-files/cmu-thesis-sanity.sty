% Make a nice command for outputting errors
\newcommand{\cmu@thesis@error}[1]{%
	{\@latex@error{#1}\@ehd}%
	%\@@end% Force early quit?
}

\newcommand{\cmu@ogs@error}[1]{%
	\ifx \cmu@thesis@nochecks\@false \relax%
		\cmu@thesis@error{OGS Incompliant Document: #1}%
	\fi%
}

% Make nice command sfor outputting warnings
\newcommand{\cmu@thesis@warning}[1]{%
	{\@latex@warning@no@line{#1}}%
}
\newcommand{\cmu@thesis@warning@with@line}[1]{%
	{\@latex@warning{#1}}%
}

% Make sure the variable (#1) is set, if it's not then output an error
\newcommand{\sanitize}[2]{
	\ifx#1\@empty
		\cmu@thesis@error{No #2 given}
	\fi
}

% Make sure a section/environment (#1) is set, if it's not then output an error
\newcommand{\requiredsection}[2]{
	\ifx\cmu@thesis@nochecks\@false
		\ifx#1\@empty
			\cmu@thesis@error{Required section (environment) missing: #2}
		\fi
	\fi
}

% Make sure a section/environment (#1) is set, if it's not then output a warning
\newcommand{\suggestedsection}[2]{
	\ifx\cmu@thesis@nochecks\@false
		\ifx#1\@empty
			\cmu@thesis@warning{It is recommended that you include the '#2' section (environment)}
		\fi
	\fi
}

% Make sure a section/environment (#1) is NOT set, if it's SET then output an error
% The reason for the failure is output in parenthesis (#3)
\newcommand{\disallowedsection}[3]{
	\ifx\cmu@thesis@nochecks\@false
		\ifx#1\@true
			\cmu@thesis@warning{Disallowed section (environment) exists: #2 (#3)}
		\fi
	\fi
}

% Make sure ``fullpage'' does not get included!
\AtBeginDocument{
	\@ifpackageloaded{fullpage}{\cmu@thesis@error{The 'fullpage' package is incompatible with cmu-thesis}}{}
}

% Construct a custom command for performing operations at the end of the preamble
\global\let\cmu@endpreamblehook\@empty
\@onlypreamble\cmu@AtEndPreamble
\gdef\cmu@AtEndPreamble{\g@addto@macro\cmu@endpreamblehook}
% and at the end of the beginning of the document
\global\let\cmu@begindocumenthook\@empty
\@onlypreamble\cmu@AtBeginDocumentLast
\gdef\cmu@AtBeginDocumentLast{\g@addto@macro\cmu@begindocumenthook}
% code for both:
\global\let\orig@begin@document=\document
\gdef\document{%
	\endgroup
	\let\cmu@AtEndPreamble\@firstofone%
	\cmu@endpreamblehook%
	\global\let\cmu@endpreamblehook\@empty%
	\begingroup
	\orig@begin@document%
	\let\cmu@AtBeginDocumentLast\@firstofone%
	\cmu@begindocumenthook%
	\global\let\cmu@begindocumenthook\@empty%
}
